<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Envelope Animation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Google Fonts for handwritten font -->
    <link href="https://fonts.googleapis.com/css2?family=Homemade+Apple&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-image: url('https://i.imgur.com/ztRVBsH.jpeg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            min-height: 100vh;
            overflow-x: hidden;
        }

        main {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: center;
            min-height: 100vh;
            position: relative;
            padding: 20px;
        }

        .envelope {
            width: 40vw;
            height: 26.67vw;
            max-width: 600px;
            max-height: 400px;
            min-width: 200px;
            min-height: 133.33px;
            position: relative;
            cursor: pointer;
            perspective: 1000px;
            margin-left: 20px;
            margin-top: 20px;
            margin-bottom: 20px;
            z-index: 2;
        }

        .envelope-front, .envelope-back, .envelope-flap {
            position: absolute;
            width: 100%;
            height: 100%;
            transition: transform 0.6s ease, opacity 0.6s ease;
            transform-style: preserve-3d;
            box-sizing: border-box;
        }

        .envelope-back {
            background-color: #e0c4a8;
            border: 2px solid #000;
            transform: rotateY(180deg);
        }

        .envelope-front {
            background-color: #f4e4bc;
            border: 2px solid #000;
            z-index: 2;
        }

        .envelope-flap {
            background-color: #f4e4bc;
            clip-path: polygon(0 0, 50% 100%, 100% 0);
            border-left: 2px solid #000;
            border-right: 2px solid #000;
            border-top: 2px solid #000;
            border-bottom: none;
            transform-origin: top;
            z-index: 3;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding-top: 40px;
        }

        .open-me {
            font-size: 24px;
            color: #000;
            text-align: center;
            margin-bottom: 30px;
            transform: translateZ(10px);
            transition: opacity 0.3s ease;
        }

        .envelope.open .open-me {
            opacity: 0;
        }

        .heart {
            position: absolute;
            bottom: 10px;
            font-size: 20px;
            transform: translateZ(10px);
        }

        .envelope-letter {
            width: 420px;
            height: 594px;
            max-width: calc(100vw - 40px);
            max-height: calc(100vh - 40px);
            background-color: #fff;
            border: 1px solid #ccc;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transform: translateX(0) scale(0.2);
            opacity: 0;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 20px;
            z-index: 1;
            position: absolute;
            left: 50%;
            top: 50%;
            transform-origin: center;
            margin-top: calc(-297px);
            transition: transform 0.9s ease 0.3s, opacity 0.9s ease 0.3s, left 0.9s ease 0.3s;
        }

        .letter-content {
            font-size: 18px;
            color: #333;
            max-height: calc(100% - 40px);
            overflow-y: auto;
            width: 100%;
            box-sizing: border-box;
            font-family: 'Homemade Apple', cursive;
            font-weight: normal;
            line-height: 1.6;
            text-align: justify; /* Justify text alignment */
        }

        .letter-content p {
            margin: 0 0 15px 0;
        }

        .emoji {
            position: absolute;
            font-size: 30px;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) translateZ(0);
            opacity: 0;
            z-index: 6;
            pointer-events: none;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
        }

        .envelope.open .emoji:nth-child(1) { animation: firework 0.9s ease forwards 0.3s; }
        .envelope.open .emoji:nth-child(2) { animation: firework 0.9s ease forwards 0.31s; }
        .envelope.open .emoji:nth-child(3) { animation: firework 0.9s ease forwards 0.32s; }
        .envelope.open .emoji:nth-child(4) { animation: firework 0.9s ease forwards 0.33s; }
        .envelope.open .emoji:nth-child(5) { animation: firework 0.9s ease forwards 0.34s; }
        .envelope.open .emoji:nth-child(6) { animation: firework 0.9s ease forwards 0.35s; }
        .envelope.open .emoji:nth-child(7) { animation: firework 0.9s ease forwards 0.36s; }
        .envelope.open .emoji:nth-child(8) { animation: firework 0.9s ease forwards 0.37s; }
        .envelope.open .emoji:nth-child(9) { animation: firework 0.9s ease forwards 0.38s; }
        .envelope.open .emoji:nth-child(10) { animation: firework 0.9s ease forwards 0.39s; }
        .envelope.open .emoji:nth-child(11) { animation: firework 0.9s ease forwards 0.4s; }
        .envelope.open .emoji:nth-child(12) { animation: firework 0.9s ease forwards 0.41s; }
        .envelope.open .emoji:nth-child(13) { animation: firework 0.9s ease forwards 0.42s; }
        .envelope.open .emoji:nth-child(14) { animation: firework 0.9s ease forwards 0.43s; }
        .envelope.open .emoji:nth-child(15) { animation: firework 0.9s ease forwards 0.44s; }
        .envelope.open .emoji:nth-child(16) { animation: firework 0.9s ease forwards 0.45s; }
        .envelope.open .emoji:nth-child(17) { animation: firework 0.9s ease forwards 0.46s; }
        .envelope.open .emoji:nth-child(18) { animation: firework 0.9s ease forwards 0.47s; }
        .envelope.open .emoji:nth-child(19) { animation: firework 0.9s ease forwards 0.48s; }
        .envelope.open .emoji:nth-child(20) { animation: firework 0.9s ease forwards 0.49s; }
        .envelope.open .emoji:nth-child(21) { animation: firework 0.9s ease forwards 0.5s; }
        .envelope.open .emoji:nth-child(22) { animation: firework 0.9s ease forwards 0.51s; }
        .envelope.open .emoji:nth-child(23) { animation: firework 0.9s ease forwards 0.52s; }
        .envelope.open .emoji:nth-child(24) { animation: firework 0.9s ease forwards 0.53s; }

        @keyframes firework {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) translateZ(0) scale(1);
            }
            80% {
                opacity: 0.8;
                transform: translate(-50%, -50%) translate(var(--tx, 0px), var(--ty, 0px)) translateZ(100px) scale(1.5);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) translate(var(--tx, 0px), var(--ty, 0px)) translateZ(100px) scale(1.5);
            }
        }

        .envelope.open {
            z-index: 1;
        }

        .envelope.open .envelope-flap {
            transform: rotateX(180deg);
        }

        .envelope.open .envelope-letter {
            left: calc(100% - 420px - 20px);
            transform: translateX(0) scale(1);
            opacity: 1;
            z-index: 5;
        }

        .download-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #000;
            color: #fff;
            border: none;
            border-radius: 5px;
            z-index: 7;
        }

        .download-btn:hover {
            background-color: #333;
        }

        @media (max-width: 768px) {
            .envelope {
                width: 60vw;
                height: 40vw;
                max-width: 400px;
                max-height: 266.67px;
                margin-left: 15px;
            }

            .envelope-letter {
                width: 210px;
                height: 297px;
                max-width: calc(100vw - 30px);
                max-height: calc(100vh - 30px);
                padding: 15px;
                left: 50%;
                margin-top: calc(-148.5px);
            }

            .envelope.open .envelope-letter {
                left: calc(100% - 210px - 15px);
            }

            .letter-content {
                font-size: 14px;
                max-height: calc(100% - 30px);
                text-align: justify; /* Maintain justified text */
            }

            .open-me {
                font-size: 18px;
                margin-bottom: 20px;
                padding-top: 30px;
            }

            .heart {
                font-size: 16px;
                bottom: 8px;
            }

            .download-btn {
                padding: 8px 16px;
                font-size: 14px;
                right: 15px;
                bottom: 15px;
            }

            .emoji {
                font-size: 24px;
            }
        }

        @media (max-width: 480px) {
            .envelope {
                width: 80vw;
                height: 53.33vw;
                max-width: 300px;
                max-height: 200px;
                margin-left: 10px;
            }

            .envelope-letter {
                width: 150px;
                height: 212px;
                max-width: calc(100vw - 20px);
                max-height: calc(100vh - 20px);
                padding: 10px;
                left: 50%;
                margin-top: calc(-106px);
            }

            .envelope.open .envelope-letter {
                left: calc(100% - 150px - 10px);
            }

            .letter-content {
                font-size: 12px;
                max-height: calc(100% - 20px);
                text-align: justify; /* Maintain justified text */
            }

            .open-me {
                font-size: 14px;
                margin-bottom: 15px;
                padding-top: 20px;
            }

            .download-btn {
                padding: 6px 12px;
                font-size: 12px;
                right: 10px;
                bottom: 10px;
            }

            .emoji {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <main>
        <div class="envelope" id="envelope">
            <div class="envelope-back"></div>
            <div class="envelope-front"></div>
            <div class="envelope-flap">
                <span class="open-me">Open Me</span>
                <span class="heart">‚ù§Ô∏è</span>
            </div>
            <div class="envelope-letter" id="letter">
                <div class="letter-content" id="letterContent"></div>
            </div>
            <!-- Emoji fireworks (mix of flowers and hearts, 24 total) -->
            <span class="emoji">üå∏</span>
            <span class="emoji">‚ù§Ô∏è</span>
            <span class="emoji">üåπ</span>
            <span class="emoji">üíñ</span>
            <span class="emoji">üå∑</span>
            <span class="emoji">üíï</span>
            <span class="emoji">üå∫</span>
            <span class="emoji">üíì</span>
            <span class="emoji">üåª</span>
            <span class="emoji">üíó</span>
            <span class="emoji">üíê</span>
            <span class="emoji">üíû</span>
            <span class="emoji">üåº</span>
            <span class="emoji">‚ù§Ô∏è</span>
            <span class="emoji">ü™∑</span>
            <span class="emoji">üíñ</span>
            <span class="emoji">üå∏</span>
            <span class="emoji">üíï</span>
            <span class="emoji">üåπ</span>
            <span class="emoji">üíì</span>
            <span class="emoji">üå∑</span>
            <span class="emoji">üíó</span>
            <span class="emoji">üå∫</span>
            <span class="emoji">üíû</span>
        </div>
    </main>
    <button class="download-btn" id="downloadBtn">Download Letter</button>

    <script>
        const { jsPDF } = window.jspdf;
        const envelope = document.getElementById('envelope');
        const letterContent = document.getElementById('letterContent');
        const downloadBtn = document.getElementById('downloadBtn');

        // Letter content with paragraphs and line breaks
        const letterText = [
           `Mon Amour,`,
            `I wrote this letter because of the impact written words have and in an a way to open up a new medium of communication, and confront my feelings.`,
            `Ever since our last call, my mind has been racing and an overwhelming urge of capturing my feelings has taken hold.`,
            `I want to start by apologizing for the way I treated and neglected us. I realize now the pain and confusion some of my actions have generated, and I'm sorry.<br>The truth is that I am broken. Well, more like my emotional self is broken. <br>  I have been uncapable of managing my feelings, trying hard to control outcomes, that, in the end blow straight back into my face. And you have been at the center of it all. Im sorry.`,
            `What I know is that I won't continue living this way. For too long I have been suffocated by an invisible weight, and it's now essential for me to break free. <br> I need fixing up. By opening up to start with and take a deeper look into myself. And though this is my journey, I deeply want you by my side.`,
            `My feelings for you have always been real. You are the first I think of in the morning and the last at night. You as the one I want to dream big with, and the one I want to make feel safe.`,

            `You have witnessed my worst version. I want to show you my best.`
        ];

        // Add paragraphs to letter content
        letterText.forEach(paragraph => {
            const p = document.createElement('p');
            p.innerHTML = paragraph; // Use innerHTML to render <br> tags
            letterContent.appendChild(p);
        });

        // Toggle envelope open/close on click
        envelope.addEventListener('click', () => {
            envelope.classList.toggle('open');
            // Reset emojis on close
            if (!envelope.classList.contains('open')) {
                document.querySelectorAll('.emoji').forEach(emoji => {
                    emoji.style.opacity = '0';
                    emoji.style.transform = 'translate(-50%, -50%) translateZ(0) scale(1)';
                });
            }
        });

        // Download letter as PDF
        downloadBtn.addEventListener('click', () => {
            const doc = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4'
            });
            doc.setFont('helvetica'); // Use default font for PDF
            doc.setFontSize(12);
            // Convert <br> to \n for PDF
            const pdfText = letterText.map(text => text.replace(/<br>/g, '\n')).join('\n\n');
            doc.text(pdfText, 10, 10, { maxWidth: 190 });
            doc.save('letter.pdf');
        });

        // Randomize emoji translations for fireworks effect
        document.querySelectorAll('.emoji').forEach(emoji => {
            const tx = (Math.random() - 0.5) * 600; // Random x: -300px to 300px
            const ty = (Math.random() - 0.5) * 600; // Random y: -300px to 300px
            emoji.style.setProperty('--tx', `${tx}px`);
            emoji.style.setProperty('--ty', `${ty}px`);
        });
    </script>
</body>
</html>
